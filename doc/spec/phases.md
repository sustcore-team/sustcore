# Phases 内核阶段

内核主要分为以下三个阶段:

1. Pre-Initialization (预初始化阶段)
2. Post-Initialization (后初始化阶段)
3. Runtime (运行时阶段)

## 1. 各阶段简介

### 1. Pre-Initialization (预初始化阶段)

预初始化阶段是内核启动的第一个阶段.
此阶段内, 内核仍然工作在低端内存区域. 此时内核将尽可能早地初始化页表并过渡到高端内存区域.
在此阶段, 内核将初始化最基本的子系统, 例如内存管理子系统和中断子系统.

### 2. Post-Initialization (后初始化阶段)

后初始化阶段是内核启动的第二个阶段. 此时的内核工作在高端内存区域.
此阶段内, 内核已经过渡到高端内存区域. 之后系统将会初始化Capability子系统,
进程子系统等部分.

### 3. Runtime (运行时阶段)

此时内核已经完成了初始化工作, 进入正常的运行时阶段.

## 2. PhasedSystem Trait

对于内核中的某些子系统, 它们的工作周期一般会横跨多个阶段, 并且随着阶段的变化, 要做出相应的调整. 最主要的就是从Pre-Initialization阶段过渡到Post-Initialization阶段.
此时内核的内存布局已经发生了变化, 子系统内部的指针可能仍然指向低端内存区域, 需要进行更新.
因此, 我们定义了 PhasedSystem Trait 来描述这些子系统的行为.
PhasedSystem Trait 中的函数并没有固定的语义要求与参数要求, 但其目的均是一致的: 在不同的阶段执行相应的初始化或调整工作.

### 2.1 void pre_init(...)

在 Pre-Initialization 阶段调用该函数.
此函数用于在预初始化阶段执行子系统的初始化工作.

### 2.2 void post_init(...)

在 Post-Initialization 阶段调用该函数.
此函数用于在后初始化阶段执行子系统的初始化或调整工作.

### 2.3 void runtime_init(...)

在 Runtime 阶段调用该函数.
此函数用于在运行时阶段执行子系统的初始化或调整工作.